{"version":3,"file":"kayaks.esm.js","sources":["../src/util/actions.ts","../node_modules/tslib/tslib.es6.js","../src/watcher.ts","../src/model.ts","../src/combineReducers.ts","../src/util/index.ts","../src/index.ts"],"sourcesContent":["\r\nconst randomString = () =>\r\n  Math.random().toString(36).substring(8).split('').join('_')\r\n\r\nconst ActionTypes = {\r\n  INIT: `@@kayak/INIT${randomString()}`,\r\n  REPLACE: `@@kayak/REPLACE${randomString()}`,\r\n}\r\n\r\nexport default ActionTypes\r\n\r\nexport function isObject(action: any) {\r\n  return typeof action == 'object' && action != null;\r\n}","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","\r\nexport default class Watcher {\r\n    static watchers: Array<Function> = [];\r\n    static keyMap: Map<string, Array<Function>> = new Map();\r\n    static isExec: boolean = false;\r\n  \r\n    public static async update(key: string,fn:Function): Promise<void> {\r\n        if (this.isExec) {\r\n            return;\r\n        }\r\n        this.isExec = true;\r\n        let extra:Array<any>=[];\r\n        if(key!==undefined ){\r\n            extra=Watcher.keyMap.get(key)||[];\r\n        }\r\n        \r\n        let watchers:Array<Function>=[...Watcher.watchers,...extra];\r\n       await fn();\r\n        watchers?.forEach(fn => fn());\r\n        \r\n        this.isExec=false;\r\n    }\r\n    static remove(fn: Function, key?: string) {\r\n        let watchers:Array<Function>|undefined=this.watchSelect(key);\r\n        watchers?.splice(watchers.indexOf(fn), 1);\r\n    }\r\n    static add(fn: Function, key?: string) {\r\n        let watchers:Array<Function>|undefined=this.watchSelect(key);\r\n        if (key && watchers === undefined) {\r\n            this.keyMap.set(key, new Array());\r\n            this.keyMap.get(key)?.push(fn);\r\n        }\r\n        watchers?.push(fn);\r\n    }\r\n    private static  watchSelect(key: string | undefined) {\r\n        return key === undefined ? Watcher.watchers : Watcher.keyMap.get(key);\r\n    }\r\n}","import Watcher from \"./watcher\";\r\n\r\nexport default class Model {\r\n\r\n    constructor(data: object,fn:Function) {\r\n        \r\n        let proxy = new Proxy(data, {\r\n            set: (src: any, key: string, value: any, receiver: any) => {\r\n\r\n                //值未变,proxy 不处理\r\n                if (src[key] === value) {\r\n                    return true;\r\n                }\r\n                //不处理原型属性 \r\n                let excludes = ['__proto__', 'constructor'];\r\n\r\n                if (excludes.includes(<string>key)) {\r\n                    return true;\r\n                }\r\n                ;\r\n\r\n                if (key != '$watch') {\r\n                    Watcher.update(key,fn);\r\n                }\r\n\r\n                return Reflect.set(src, key, value, receiver);\r\n            },\r\n            get: (src: any, key: string | symbol, receiver) => {\r\n                let res = Reflect.get(src, key, receiver);\r\n\r\n                let data = ModelManager.getFromDataMap(src[key]);\r\n                if (data) {\r\n                    return data;\r\n                }\r\n                if (typeof res === 'object' && res !== null) {\r\n                    if (!src[key].$watch) {\r\n                        let p = new Model(res,fn);\r\n                        return p;\r\n                    }\r\n                }\r\n                return res;\r\n            },\r\n            deleteProperty: function (src: any, key: any) {\r\n                if (src[key] != null && typeof src[key] === 'object') {\r\n                    ModelManager.delToDataMap(src[key]);\r\n                }\r\n                delete src[key];\r\n                return true;\r\n            }\r\n        });\r\n        proxy.$watch = true;\r\n\r\n        ModelManager.addToDataMap(data, proxy);\r\n\r\n        return proxy;\r\n    }\r\n\r\n}\r\n\r\nclass ModelManager {\r\n    private static dataMap: WeakMap<object, Model> = new WeakMap();\r\n\r\n    static addToDataMap(data: any, proxy: any) {\r\n        this.dataMap.set(data, proxy);\r\n    }\r\n\r\n    static delToDataMap(data: any) {\r\n        this.dataMap.delete(data);\r\n    }\r\n\r\n    static getFromDataMap(data: any) {\r\n        return this.dataMap.get(data);\r\n    }\r\n}\r\n","import ActionTypes from \"./util/actions\"\r\nimport { Reducer, ReducersObject, StateObject } from \"./types/reducer\"\r\nimport { AnyAction } from \"./types/action\"\r\nexport default function combineReducers(reducers: ReducersObject | any): Reducer {\r\n  const reducerKeys = Object.keys(reducers);\r\n  const combineReducers: ReducersObject = {};\r\n\r\n  for (let i = 0; i < reducerKeys.length; i++) {\r\n    const key:string = reducerKeys[i]\r\n\r\n    if (typeof reducers[key] === 'function') {\r\n      combineReducers[key] = reducers[key]\r\n    } else {\r\n      throw new Error(`${key}对应的reducer不是函数，请确保${reducers[key]}为函数,\r\n                      Please ensure that the reducer you provide is a function\r\n        `);\r\n    }\r\n  }\r\n  const combineKeys = Object.keys(combineReducers);\r\n\r\n\r\n  let shapeAssertionError: Error\r\n  try {\r\n    assertReducerShape(combineReducers)\r\n  } catch (e) {\r\n    shapeAssertionError = e\r\n  }\r\n\r\n  return function (\r\n    state: StateObject<typeof reducers> = {},\r\n    action: AnyAction,\r\n  ) {\r\n    if (shapeAssertionError) {\r\n      throw shapeAssertionError\r\n    }\r\n\r\n    for (let i = 0; i < combineKeys.length; i++) {\r\n      const key = combineKeys[i]\r\n      const reducer = combineReducers[key]\r\n      const previousStateForKey = state[key]\r\n      const nextStateForKey = reducer(previousStateForKey, action)\r\n      if (typeof nextStateForKey === 'undefined') {\r\n        const actionType = action && action.type\r\n        throw new Error(\r\n          `When called with an action of type ${actionType ? `\"${String(actionType)}\"` : '(unknown type)'\r\n          }, the slice reducer for key \"${key}\" returned undefined. ` +\r\n          `To ignore an action, you must explicitly return the previous state. ` +\r\n          `If you want this reducer to hold no value, you can return null instead of undefined.`\r\n        )\r\n      }\r\n\r\n      state[key] = nextStateForKey;\r\n    }\r\n\r\n  }\r\n}\r\nfunction assertReducerShape(reducers: ReducersObject) {\r\n  Object.keys(reducers).forEach(key => {\r\n    const reducer = reducers[key]\r\n    const initialState = reducer(undefined, { type: ActionTypes.INIT })\r\n\r\n    if (typeof initialState === 'undefined') {\r\n      throw new Error(\r\n        `The slice reducer for key \"${key}\" returned undefined during initialization. ` +\r\n        `If the state passed to the reducer is undefined, you must ` +\r\n        `explicitly return the initial state. The initial state may ` +\r\n        `not be undefined. If you don't want to set a value for this reducer, ` +\r\n        `you can use null instead of undefined.`\r\n      )\r\n    }\r\n\r\n    if (\r\n      typeof reducer(undefined, {\r\n        type: ActionTypes.INIT + '1'\r\n      }) === 'undefined'\r\n    ) {\r\n      throw new Error(\r\n        `The slice reducer for key \"${key}\" returned undefined when probed with a random type. ` +\r\n        `Don't try to handle '${ActionTypes.INIT}' or other actions in \"redux/*\" ` +\r\n        `namespace. They are considered private. Instead, you must return the ` +\r\n        `current state for any unknown actions, unless it is undefined, ` +\r\n        `in which case you must return the initial state, regardless of the ` +\r\n        `action type. The initial state may not be undefined, but can be null.`\r\n      )\r\n    }\r\n  })\r\n}","\r\nexport default function clone(proxy: object,...exc:Array<string>) :object {\r\n\r\n    let ds: Array<string> = Object.getOwnPropertyNames(proxy);\r\n    let res = new Object();\r\n    for (let i = 0; i < ds.length; i++) {\r\n        if (proxy.hasOwnProperty(ds[i])&&ds[i]!=='$watch'&&!exc.includes(ds[i])) {\r\n            let param = Reflect.get(proxy, ds[i]);\r\n            Object.defineProperty(res, ds[i], {\r\n                value: function () {\r\n                    if (typeof param === 'object' && param !== null) {\r\n                        return clone(param)\r\n                    } else {\r\n                        return param\r\n                    }\r\n                }(),\r\n                enumerable:true\r\n            })\r\n        }\r\n    }\r\n    return res;\r\n}","\r\nimport Action from './types/action';\r\nimport { Reducer } from './types/reducer';\r\nimport ActionTypes, { isObject } from './util/actions';\r\nimport Watcher from './watcher';\r\nimport Model from './model';\r\nimport combineReducers from './combineReducers';\r\nimport clone from './util/index';\r\n\r\n/**\r\n * \r\n * @param reducer A function to process your action state\r\n * @returns An object that controls your state repository\r\n */\r\nexport default function createStore(reducer: Reducer | object) {\r\n    /**\r\n     * Is the scheduling Reducer method being executed\r\n     */\r\n    let isDispatching: boolean = false;\r\n    /**\r\n     * \r\n     *  If there is only one reducer function, set the default value\r\n     */\r\n    let currentReducer = typeof reducer === 'function' ? reducer : combineReducers(reducer);\r\n    /**\r\n     *  \r\n        初始化数据\r\n        Initialization data\r\n     */\r\n    let data = {\r\n        'currentState': undefined\r\n    };\r\n    /**\r\n     * 初始化代理对象返回的proxy\r\n     * Initializes the proxy returned by the proxy object\r\n     */\r\n    let proxy: any;\r\n\r\n    let combine: boolean = typeof reducer === 'function' ? false : true;\r\n\r\n    /**\r\n     * \r\n     * @param action Action对象，要求传入type,\r\n     *              Action object. Type is required\r\n     */\r\n    function dispatch(action: Action) {\r\n        if (!isObject(action)) {\r\n            throw new Error(\r\n                `Actions must be a objects. Instead, the actual type was: '${typeof action}'`\r\n            )\r\n        }\r\n\r\n        if (typeof action.type === 'undefined') {\r\n            throw new Error(\r\n                'Actions may not have an undefined \"type\" property. You may have misspelled an action type string constant.'\r\n            )\r\n        }\r\n\r\n        let currentState = data.currentState;\r\n        try {\r\n            isDispatching = true\r\n            if (combine) {\r\n                currentReducer(proxy, action);\r\n            } else {\r\n                proxy['currentState'] = currentReducer(currentState, action);\r\n            }\r\n        } finally {\r\n            isDispatching = false\r\n        }\r\n    }\r\n    function subscribe(listener: () => void, key?: string) {\r\n        if (typeof listener !== 'function') {\r\n            throw new Error(\r\n                `Expected the listener to be a function. Instead, received: '${typeof (\r\n                    listener\r\n                )}'`\r\n            )\r\n        }\r\n        if (isDispatching) {\r\n            throw new Error(\r\n                'You may not call store.subscribe() while the reducer is executing. ' +\r\n                'If you would like to be notified after the store has been updated, subscribe from a ' +\r\n                'component and invoke store.getState() in the callback to access the latest state. ' +\r\n                'See https://redux.js.org/api/store#subscribelistener for more details.'\r\n            )\r\n        }\r\n        let isSubscribed = true;\r\n        key !== undefined ? Watcher.add(listener, key) : Watcher.add(listener);\r\n        return function unsubscribe() {\r\n            if (!isSubscribed) {\r\n                return\r\n            }\r\n\r\n            if (isDispatching) {\r\n                throw new Error(\r\n                    'You may not unsubscribe from a store listener while the reducer is executing. '\r\n                )\r\n            }\r\n            Watcher.remove(listener, key);\r\n            isSubscribed = false;\r\n        }\r\n\r\n\r\n    }\r\n    function getState() {\r\n        if (isDispatching) {\r\n            throw new Error(\r\n                'You may not call store.getState() while the reducer is executing. ' +\r\n                'The reducer has already received the state as an argument. ' +\r\n                'Pass it down from the top reducer instead of reading it from the store.' +\r\n                'reducer还在执行中'\r\n            )\r\n        }\r\n        /**\r\n         * get clone object\r\n         */\r\n        const res: any = combine ? clone(data, 'currentState') : clone(data);\r\n\r\n        return combine ? res : res['currentState'];\r\n    }\r\n    /**\r\n     * \r\n     * @param newReducer A new Reducer replaces the original reducer function\r\n     * @returns store\r\n     */\r\n    function replace(newReducer: Reducer) {\r\n        if (typeof newReducer !== 'function') {\r\n            throw new Error(\r\n                `Expected the nextReducer to be a function. Instead, received: '${typeof\r\n                newReducer\r\n                }`\r\n            )\r\n        }\r\n        currentReducer =newReducer;\r\n        dispatch({ type: ActionTypes.REPLACE } as Action);\r\n        \r\n        return store;\r\n    }\r\n    function update(){\r\n        isDispatching=false;\r\n    }\r\n    /**\r\n     *   proxy Initialize data\r\n     */\r\n    \r\n    proxy = new Model(data,update);\r\n    /**\r\n     * state get default data\r\n     */\r\n    dispatch({ type: ActionTypes.INIT } as Action);\r\n\r\n    const store = {\r\n        dispatch: dispatch,\r\n        subscribe,\r\n        getState,\r\n        replace,\r\n    }\r\n    return store;\r\n}"],"names":[],"mappings":"AACA,MAAM,YAAY,GAAG,MACnB,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;AAE7D,MAAM,WAAW,GAAG;IAClB,IAAI,EAAE,eAAe,YAAY,EAAE,EAAE;IACrC,OAAO,EAAE,kBAAkB,YAAY,EAAE,EAAE;CAC5C,CAAA;SAIe,QAAQ,CAAC,MAAW;IAClC,OAAO,OAAO,MAAM,IAAI,QAAQ,IAAI,MAAM,IAAI,IAAI,CAAC;AACrD;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAuDA;AACO,SAAS,SAAS,CAAC,OAAO,EAAE,UAAU,EAAE,CAAC,EAAE,SAAS,EAAE;AAC7D,IAAI,SAAS,KAAK,CAAC,KAAK,EAAE,EAAE,OAAO,KAAK,YAAY,CAAC,GAAG,KAAK,GAAG,IAAI,CAAC,CAAC,UAAU,OAAO,EAAE,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;AAChH,IAAI,OAAO,KAAK,CAAC,KAAK,CAAC,GAAG,OAAO,CAAC,EAAE,UAAU,OAAO,EAAE,MAAM,EAAE;AAC/D,QAAQ,SAAS,SAAS,CAAC,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE;AACnG,QAAQ,SAAS,QAAQ,CAAC,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE;AACtG,QAAQ,SAAS,IAAI,CAAC,MAAM,EAAE,EAAE,MAAM,CAAC,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC,EAAE;AACtH,QAAQ,IAAI,CAAC,CAAC,SAAS,GAAG,SAAS,CAAC,KAAK,CAAC,OAAO,EAAE,UAAU,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;AAC9E,KAAK,CAAC,CAAC;AACP;;MC5EqB,OAAO;IAKjB,OAAa,MAAM,CAAC,GAAW,EAAC,EAAW;;YAC9C,IAAI,IAAI,CAAC,MAAM,EAAE;gBACb,OAAO;aACV;YACD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YACnB,IAAI,KAAK,GAAY,EAAE,CAAC;YACxB,IAAG,GAAG,KAAG,SAAS,EAAE;gBAChB,KAAK,GAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,IAAE,EAAE,CAAC;aACrC;YAED,IAAI,QAAQ,GAAiB,CAAC,GAAG,OAAO,CAAC,QAAQ,EAAC,GAAG,KAAK,CAAC,CAAC;YAC7D,MAAM,EAAE,EAAE,CAAC;YACV,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,OAAO,CAAC,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;YAE9B,IAAI,CAAC,MAAM,GAAC,KAAK,CAAC;SACrB;KAAA;IACD,OAAO,MAAM,CAAC,EAAY,EAAE,GAAY;QACpC,IAAI,QAAQ,GAA2B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QAC7D,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;KAC7C;IACD,OAAO,GAAG,CAAC,EAAY,EAAE,GAAY;;QACjC,IAAI,QAAQ,GAA2B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QAC7D,IAAI,GAAG,IAAI,QAAQ,KAAK,SAAS,EAAE;YAC/B,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,KAAK,EAAE,CAAC,CAAC;YAClC,MAAA,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,0CAAE,IAAI,CAAC,EAAE,CAAC,CAAC;SAClC;QACD,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,IAAI,CAAC,EAAE,CAAC,CAAC;KACtB;IACO,OAAQ,WAAW,CAAC,GAAuB;QAC/C,OAAO,GAAG,KAAK,SAAS,GAAG,OAAO,CAAC,QAAQ,GAAG,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;KACzE;;AAlCM,gBAAQ,GAAoB,EAAE,CAAC;AAC/B,cAAM,GAAiC,IAAI,GAAG,EAAE,CAAC;AACjD,cAAM,GAAY,KAAK;;MCFb,KAAK;IAEtB,YAAY,IAAY,EAAC,EAAW;QAEhC,IAAI,KAAK,GAAG,IAAI,KAAK,CAAC,IAAI,EAAE;YACxB,GAAG,EAAE,CAAC,GAAQ,EAAE,GAAW,EAAE,KAAU,EAAE,QAAa;;gBAGlD,IAAI,GAAG,CAAC,GAAG,CAAC,KAAK,KAAK,EAAE;oBACpB,OAAO,IAAI,CAAC;iBACf;;gBAED,IAAI,QAAQ,GAAG,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC;gBAE5C,IAAI,QAAQ,CAAC,QAAQ,CAAS,GAAG,CAAC,EAAE;oBAChC,OAAO,IAAI,CAAC;iBACf;gBAGD,IAAI,GAAG,IAAI,QAAQ,EAAE;oBACjB,OAAO,CAAC,MAAM,CAAC,GAAG,EAAC,EAAE,CAAC,CAAC;iBAC1B;gBAED,OAAO,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;aACjD;YACD,GAAG,EAAE,CAAC,GAAQ,EAAE,GAAoB,EAAE,QAAQ;gBAC1C,IAAI,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;gBAE1C,IAAI,IAAI,GAAG,YAAY,CAAC,cAAc,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;gBACjD,IAAI,IAAI,EAAE;oBACN,OAAO,IAAI,CAAC;iBACf;gBACD,IAAI,OAAO,GAAG,KAAK,QAAQ,IAAI,GAAG,KAAK,IAAI,EAAE;oBACzC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE;wBAClB,IAAI,CAAC,GAAG,IAAI,KAAK,CAAC,GAAG,EAAC,EAAE,CAAC,CAAC;wBAC1B,OAAO,CAAC,CAAC;qBACZ;iBACJ;gBACD,OAAO,GAAG,CAAC;aACd;YACD,cAAc,EAAE,UAAU,GAAQ,EAAE,GAAQ;gBACxC,IAAI,GAAG,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,OAAO,GAAG,CAAC,GAAG,CAAC,KAAK,QAAQ,EAAE;oBAClD,YAAY,CAAC,YAAY,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;iBACvC;gBACD,OAAO,GAAG,CAAC,GAAG,CAAC,CAAC;gBAChB,OAAO,IAAI,CAAC;aACf;SACJ,CAAC,CAAC;QACH,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC;QAEpB,YAAY,CAAC,YAAY,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QAEvC,OAAO,KAAK,CAAC;KAChB;CAEJ;AAED,MAAM,YAAY;IAGd,OAAO,YAAY,CAAC,IAAS,EAAE,KAAU;QACrC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;KACjC;IAED,OAAO,YAAY,CAAC,IAAS;QACzB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KAC7B;IAED,OAAO,cAAc,CAAC,IAAS;QAC3B,OAAO,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;KACjC;;AAZc,oBAAO,GAA2B,IAAI,OAAO,EAAE;;SCzD1C,eAAe,CAAC,QAA8B;IACpE,MAAM,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC1C,MAAM,eAAe,GAAmB,EAAE,CAAC;IAE3C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAC3C,MAAM,GAAG,GAAU,WAAW,CAAC,CAAC,CAAC,CAAA;QAEjC,IAAI,OAAO,QAAQ,CAAC,GAAG,CAAC,KAAK,UAAU,EAAE;YACvC,eAAe,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAA;SACrC;aAAM;YACL,MAAM,IAAI,KAAK,CAAC,GAAG,GAAG,qBAAqB,QAAQ,CAAC,GAAG,CAAC;;SAErD,CAAC,CAAC;SACN;KACF;IACD,MAAM,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;IAGjD,IAAI,mBAA0B,CAAA;IAC9B,IAAI;QACF,kBAAkB,CAAC,eAAe,CAAC,CAAA;KACpC;IAAC,OAAO,CAAC,EAAE;QACV,mBAAmB,GAAG,CAAC,CAAA;KACxB;IAED,OAAO,UACL,QAAsC,EAAE,EACxC,MAAiB;QAEjB,IAAI,mBAAmB,EAAE;YACvB,MAAM,mBAAmB,CAAA;SAC1B;QAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAC3C,MAAM,GAAG,GAAG,WAAW,CAAC,CAAC,CAAC,CAAA;YAC1B,MAAM,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,CAAA;YACpC,MAAM,mBAAmB,GAAG,KAAK,CAAC,GAAG,CAAC,CAAA;YACtC,MAAM,eAAe,GAAG,OAAO,CAAC,mBAAmB,EAAE,MAAM,CAAC,CAAA;YAC5D,IAAI,OAAO,eAAe,KAAK,WAAW,EAAE;gBAC1C,MAAM,UAAU,GAAG,MAAM,IAAI,MAAM,CAAC,IAAI,CAAA;gBACxC,MAAM,IAAI,KAAK,CACb,sCAAsC,UAAU,GAAG,IAAI,MAAM,CAAC,UAAU,CAAC,GAAG,GAAG,gBAC/E,gCAAgC,GAAG,wBAAwB;oBAC3D,sEAAsE;oBACtE,sFAAsF,CACvF,CAAA;aACF;YAED,KAAK,CAAC,GAAG,CAAC,GAAG,eAAe,CAAC;SAC9B;KAEF,CAAA;AACH,CAAC;AACD,SAAS,kBAAkB,CAAC,QAAwB;IAClD,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,GAAG;QAC/B,MAAM,OAAO,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAA;QAC7B,MAAM,YAAY,GAAG,OAAO,CAAC,SAAS,EAAE,EAAE,IAAI,EAAE,WAAW,CAAC,IAAI,EAAE,CAAC,CAAA;QAEnE,IAAI,OAAO,YAAY,KAAK,WAAW,EAAE;YACvC,MAAM,IAAI,KAAK,CACb,8BAA8B,GAAG,8CAA8C;gBAC/E,4DAA4D;gBAC5D,6DAA6D;gBAC7D,uEAAuE;gBACvE,wCAAwC,CACzC,CAAA;SACF;QAED,IACE,OAAO,OAAO,CAAC,SAAS,EAAE;YACxB,IAAI,EAAE,WAAW,CAAC,IAAI,GAAG,GAAG;SAC7B,CAAC,KAAK,WAAW,EAClB;YACA,MAAM,IAAI,KAAK,CACb,8BAA8B,GAAG,uDAAuD;gBACxF,wBAAwB,WAAW,CAAC,IAAI,kCAAkC;gBAC1E,uEAAuE;gBACvE,iEAAiE;gBACjE,qEAAqE;gBACrE,uEAAuE,CACxE,CAAA;SACF;KACF,CAAC,CAAA;AACJ;;SCrFwB,KAAK,CAAC,KAAa,EAAC,GAAG,GAAiB;IAE5D,IAAI,EAAE,GAAkB,MAAM,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;IAC1D,IAAI,GAAG,GAAG,IAAI,MAAM,EAAE,CAAC;IACvB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAChC,IAAI,KAAK,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAE,EAAE,CAAC,CAAC,CAAC,KAAG,QAAQ,IAAE,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE;YACrE,IAAI,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;YACtC,MAAM,CAAC,cAAc,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE;gBAC9B,KAAK,EAAE;oBACH,IAAI,OAAO,KAAK,KAAK,QAAQ,IAAI,KAAK,KAAK,IAAI,EAAE;wBAC7C,OAAO,KAAK,CAAC,KAAK,CAAC,CAAA;qBACtB;yBAAM;wBACH,OAAO,KAAK,CAAA;qBACf;iBACJ,EAAE;gBACH,UAAU,EAAC,IAAI;aAClB,CAAC,CAAA;SACL;KACJ;IACD,OAAO,GAAG,CAAC;AACf;;ACZA;;;;;SAKwB,WAAW,CAAC,OAAyB;;;;IAIzD,IAAI,aAAa,GAAY,KAAK,CAAC;;;;;IAKnC,IAAI,cAAc,GAAG,OAAO,OAAO,KAAK,UAAU,GAAG,OAAO,GAAG,eAAe,CAAC,OAAO,CAAC,CAAC;;;;;;IAMxF,IAAI,IAAI,GAAG;QACP,cAAc,EAAE,SAAS;KAC5B,CAAC;;;;;IAKF,IAAI,KAAU,CAAC;IAEf,IAAI,OAAO,GAAY,OAAO,OAAO,KAAK,UAAU,GAAG,KAAK,GAAG,IAAI,CAAC;;;;;;IAOpE,SAAS,QAAQ,CAAC,MAAc;QAC5B,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;YACnB,MAAM,IAAI,KAAK,CACX,6DAA6D,OAAO,MAAM,GAAG,CAChF,CAAA;SACJ;QAED,IAAI,OAAO,MAAM,CAAC,IAAI,KAAK,WAAW,EAAE;YACpC,MAAM,IAAI,KAAK,CACX,4GAA4G,CAC/G,CAAA;SACJ;QAED,IAAI,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;QACrC,IAAI;YACA,aAAa,GAAG,IAAI,CAAA;YACpB,IAAI,OAAO,EAAE;gBACT,cAAc,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;aACjC;iBAAM;gBACH,KAAK,CAAC,cAAc,CAAC,GAAG,cAAc,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;aAChE;SACJ;gBAAS;YACN,aAAa,GAAG,KAAK,CAAA;SACxB;KACJ;IACD,SAAS,SAAS,CAAC,QAAoB,EAAE,GAAY;QACjD,IAAI,OAAO,QAAQ,KAAK,UAAU,EAAE;YAChC,MAAM,IAAI,KAAK,CACX,+DAA+D,QAC3D,QAAQ,CACX,GAAG,CACP,CAAA;SACJ;QACD,IAAI,aAAa,EAAE;YACf,MAAM,IAAI,KAAK,CACX,qEAAqE;gBACrE,sFAAsF;gBACtF,oFAAoF;gBACpF,wEAAwE,CAC3E,CAAA;SACJ;QACD,IAAI,YAAY,GAAG,IAAI,CAAC;QACxB,GAAG,KAAK,SAAS,GAAG,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,GAAG,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACvE,OAAO,SAAS,WAAW;YACvB,IAAI,CAAC,YAAY,EAAE;gBACf,OAAM;aACT;YAED,IAAI,aAAa,EAAE;gBACf,MAAM,IAAI,KAAK,CACX,gFAAgF,CACnF,CAAA;aACJ;YACD,OAAO,CAAC,MAAM,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;YAC9B,YAAY,GAAG,KAAK,CAAC;SACxB,CAAA;KAGJ;IACD,SAAS,QAAQ;QACb,IAAI,aAAa,EAAE;YACf,MAAM,IAAI,KAAK,CACX,oEAAoE;gBACpE,6DAA6D;gBAC7D,yEAAyE;gBACzE,cAAc,CACjB,CAAA;SACJ;;;;QAID,MAAM,GAAG,GAAQ,OAAO,GAAG,KAAK,CAAC,IAAI,EAAE,cAAc,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC;QAErE,OAAO,OAAO,GAAG,GAAG,GAAG,GAAG,CAAC,cAAc,CAAC,CAAC;KAC9C;;;;;;IAMD,SAAS,OAAO,CAAC,UAAmB;QAChC,IAAI,OAAO,UAAU,KAAK,UAAU,EAAE;YAClC,MAAM,IAAI,KAAK,CACX,kEAAkE,OAClE,UACA,EAAE,CACL,CAAA;SACJ;QACD,cAAc,GAAE,UAAU,CAAC;QAC3B,QAAQ,CAAC,EAAE,IAAI,EAAE,WAAW,CAAC,OAAO,EAAY,CAAC,CAAC;QAElD,OAAO,KAAK,CAAC;KAChB;IACD,SAAS,MAAM;QACX,aAAa,GAAC,KAAK,CAAC;KACvB;;;;IAKD,KAAK,GAAG,IAAI,KAAK,CAAC,IAAI,EAAC,MAAM,CAAC,CAAC;;;;IAI/B,QAAQ,CAAC,EAAE,IAAI,EAAE,WAAW,CAAC,IAAI,EAAY,CAAC,CAAC;IAE/C,MAAM,KAAK,GAAG;QACV,QAAQ,EAAE,QAAQ;QAClB,SAAS;QACT,QAAQ;QACR,OAAO;KACV,CAAA;IACD,OAAO,KAAK,CAAC;AACjB;;;;"}